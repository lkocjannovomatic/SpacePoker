# Product Requirements Document (PRD) - SpacePoker

## 1. Product Overview
SpacePoker is a single-player, offline desktop poker game designed to create a more engaging and psychologically nuanced experience than traditional poker AI games. The application implements the No-Limit Texas Hold'em poker variant. Its core innovation lies in its Non-Player Character (NPC) opponents, which are powered by a Large Language Model (LLM). Each NPC possesses a unique, LLM-generated backstory that informs a set of personality traits (`aggression`, `bluffing`, `risk_aversion`). These traits, in turn, influence a rule-based game strategy, making each opponent's playstyle distinct and discoverable.

In addition to their unique playstyles, players can engage in real-time text conversations with the NPCs. The NPC's dialogue is generated by the LLM, guided by its established personality, allowing players to gain insights into their opponent's character through interaction. The project's primary purpose is to serve as an educational tool for the developer to gain hands-on experience in integrating LLM technology into a functional application.

## 2. User Problem
Standard single-player poker applications often fail to capture the essence of real poker. Their AI opponents are typically:
- Predictable: They rely on rigid, statistical models, making their strategies easy to decipher and exploit.
- Robotic: They lack personality and fail to simulate the psychological "meta-game" of reading an opponent.
- Unengaging: The experience is reduced to a mathematical exercise against a faceless machine, missing the social and deceptive elements that make poker compelling.

SpacePoker addresses this by creating opponents that feel more human. By giving them unique personalities that influence both their gameplay and their conversation, the game forces the player to adapt their strategy based on perceived character traits, much like in a real poker game.

## 3. Functional Requirements
### 3.1. Core Poker Engine
- Game Variant: No-Limit Texas Hold'em.
- Game Flow: The engine must manage all phases of a poker hand, including posting blinds, pre-flop, flop, turn, and river betting rounds.
- Hand Evaluation: The system will accurately evaluate poker hands at showdown to determine the winner based on standard poker hand rankings.
- All-In Logic: The engine must correctly handle all-in scenarios, including the creation of side pots if necessary (though less likely in a 1v1 scenario).
- Tie-Breakers: The system will handle tied hands by splitting the pot (a "push").

### 3.2. LLM-Powered NPCs
- NPC Generation: The application allows for the generation of up to 8 unique NPC opponents. A single button click initiates the generation process.
- Personality Derivation: For each new NPC, the system will use an LLM to generate a character backstory. This backstory is then programmatically analyzed to derive three floating-point personality factors between 0.0 and 1.0: `aggression`, `bluffing`, and `risk_aversion`.
- Strategy AI: The NPC's in-game decisions (fold, check, call, bet, raise) will be determined by a rule-based system that uses the three personality factors as inputs, combined with hand strength and game state. The LLM is not used for real-time strategic decisions.

### 3.3. Conversational AI
- Real-Time Chat: A chat interface allows the player to send text messages to the NPC during a match.
- LLM-Generated Responses: The NPC's responses are generated by a local LLM, which is prompted with the player's message and the NPC's personality profile to provide in-character replies.
- Conversation History: The chat window includes a "History" tab that displays a single block of text containing the full conversation history from the last 10 completed matches against that specific NPC.

### 3.4. UI and Game State
- Game Views: The application will consist of three main views:
    1. Start Screen: For NPC management (generate, delete, select) and navigating to the statistics screen.
    2. Game View: The main poker table interface, displaying cards, player/NPC credit stacks, the current pot size, betting controls, and the chat window.
    3. Statistics Screen: Displays win/loss records.
- Betting Controls: The player interacts with the game using "Fold", "Check/Call", and "Raise" buttons. A UI slider is used to specify the raise amount.
- Match Structure: Each match is self-contained. Both player and NPC start with 1000 credits. Blinds are fixed at 10/20. A match concludes when one participant's credit stack reaches zero.

### 3.5. Data Persistence
- Local Storage: All game data, including generated NPCs (with their backstories and personality factors), player statistics, and chat histories, will be saved to unencrypted JSON files.
- Portability: The save data will be stored in a `saves` folder located next to the game's executable, ensuring the game state is portable.
- No Mid-Match Saves: The game will not save or restore progress in the middle of a match. State is saved upon NPC creation/deletion and at the conclusion of a match.

## 4. Product Boundaries
### 4.1. What is IN Scope for the MVP
- A fully functional, single-player, offline desktop application for Windows.
- Implementation of one poker variant: No-Limit Texas Hold'em.
- A maximum of 8 generated NPC opponents.
- NPC personality driven by three specific factors (`aggression`, `bluffing`, `risk_aversion`).
- Real-time chat with NPCs powered by a local LLM.
- Persistence of NPC profiles, statistics, and chat history in local JSON files.
- A developer debug mode, enabled by manually editing the JSON save files.

### 4.2. What is OUT of Scope for the MVP
- Web, mobile, or console versions.
- Online or local multiplayer functionality.
- User accounts, authentication, or cloud-based saves.
- Saving or loading a game that is in progress.
- Dynamic or increasing blind levels.
- AI-powered generation of visual assets (e.g., NPC avatars, card designs). All assets will be pre-made or from open-source collections.
- Any form of in-game currency or monetization.

## 5. User Stories

### NPC Management
- ID: US-001
- Title: Generate a new NPC opponent
- Description: As a player, I want to generate a new NPC opponent from an empty slot on the start screen so that I have someone new to play against.
- Acceptance Criteria:
    - Given I am on the start screen and there is an empty NPC slot,
    - When I click the "Generate" button in that slot,
    - Then a loading indicator appears.
    - And after a short time, the loading indicator is replaced by a new NPC's name.
    - And the new NPC data (backstory, personality factors) is saved to a JSON file.

- ID: US-002
- Title: Attempt to generate an NPC when all slots are full
- Description: As a player, I want to be prevented from generating more than 8 NPCs so that the interface remains clean and the system limits are respected.
- Acceptance Criteria:
    - Given all 8 NPC slots on the start screen are filled,
    - Then the "Generate" button is not visible or is disabled in all slots.

- ID: US-003
- Title: Delete an existing NPC
- Description: As a player, I want to delete an NPC I no longer wish to play against to free up a slot for a new one.
- Acceptance Criteria:
    - Given I am on the start screen and there is at least one generated NPC,
    - When I click the "Delete" button on an NPC's card,
    - Then a confirmation dialog appears.
    - And when I confirm the deletion,
    - Then the NPC slot becomes empty again, showing the "Generate" button.
    - And the corresponding NPC data and their statistics are removed from the save files.

- ID: US-004
- Title: Cancel NPC deletion
- Description: As a player, I want to be able to cancel the deletion of an NPC in case I clicked the delete button by mistake.
- Acceptance Criteria:
    - Given I have clicked the "Delete" button on an NPC and a confirmation dialog is visible,
    - When I click the "Cancel" button (or close the dialog),
    - Then the dialog disappears.
    - And the NPC remains in their slot, unchanged.

### Game Flow
- ID: US-005
- Title: Start a match against an NPC
- Description: As a player, I want to select a generated NPC from the start screen to begin a poker match against them.
- Acceptance Criteria:
    - Given I am on the start screen and there is at least one generated NPC,
    - When I click the "Play" button on an NPC's card,
    - Then the application transitions to the Game View.
    - And a new match starts with me and the selected NPC, each having 1000 credits.
    - And the blinds are posted automatically (10 for Small Blind, 20 for Big Blind).

- ID: US-006
- Title: NPC delivers an opening line
- Description: As a player, I want the NPC to say something at the start of the match to immediately establish their character.
- Acceptance Criteria:
    - Given a new match has just started,
    - Then a message from the NPC appears in the chat window.
    - And the message is generated by the LLM based on the NPC's personality.

- ID: US-007
- Title: Player folds their hand
- Description: As a player, I want to be able to fold my hand at any point during a betting round to forfeit the current pot.
- Acceptance Criteria:
    - Given it is my turn to act in a betting round,
    - When I click the "Fold" button,
    - Then my cards are discarded.
    - And the hand immediately ends.
    - And the pot is awarded to the NPC.
    - And a new hand begins.

- ID: US-008
- Title: Player checks their option
- Description: As a player, I want to be able to check when there has been no bet in the current round, passing the action to my opponent.
- Acceptance Criteria:
    - Given it is my turn to act and no bet has been made in the current round,
    - When I click the "Check/Call" button (which should display "Check"),
    - Then the action passes to the NPC.
    - And I have not committed any more credits to the pot.

- ID: US-009
- Title: Player calls a bet
- Description: As a player, I want to be able to call my opponent's bet to match the amount they have wagered and continue with the hand.
- Acceptance Criteria:
    - Given the NPC has made a bet and it is my turn to act,
    - When I click the "Check/Call" button (which should display "Call"),
    - Then an amount of credits equal to the NPC's bet is deducted from my stack and added to the pot.
    - And the betting round proceeds or ends, depending on the game state.

- ID: US-010
- Title: Player raises a bet
- Description: As a player, I want to be able to raise my opponent's bet to increase the stakes.
- Acceptance Criteria:
    - Given it is my turn to act,
    - When I use the "Raise" slider to select an amount and click the "Raise" button,
    - Then the selected amount is deducted from my stack and added to the pot.
    - And the action returns to the NPC, who must now fold, call, or re-raise.
    - And the slider's minimum value is a legal minimum raise and its maximum value is my remaining stack (all-in).

- ID: US-011
- Title: View hand progression through betting rounds
- Description: As a player, I want to see the community cards being dealt after each betting round is complete.
- Acceptance Criteria:
    - Given the pre-flop betting round is complete,
    - Then the three Flop cards are dealt face-up on the table.
    - Given the flop betting round is complete,
    - Then the single Turn card is dealt face-up.
    - Given the turn betting round is complete,
    - Then the single River card is dealt face-up.

- ID: US-012
- Title: View the showdown
- Description: As a player, I want to see both my and the NPC's cards at the end of the final betting round to determine the winner.
- Acceptance Criteria:
    - Given the final betting round is complete and neither player has folded,
    - Then the NPC's cards are revealed.
    - And the system highlights the winning hand.
    - And a clear message announces the winner and the hand they won with (e.g., "Player wins with a Full House").
    - And the pot is awarded to the winner's stack.

- ID: US-013
- Title: Handle a tied hand
- Description: As a player, I want the pot to be split evenly if the NPC and I have the exact same hand value at showdown.
- Acceptance Criteria:
    - Given a showdown occurs and both my hand and the NPC's hand have identical value,
    - Then a message announces a "Tie".
    - And the pot is split evenly between me and the NPC.

- ID: US-014
- Title: Match ends when a player runs out of credits
- Description: As a player, I understand that the match is over when either I or the NPC has no credits left.
- Acceptance Criteria:
    - Given a hand concludes and my credit stack is now 0,
    - Then a match summary screen appears declaring the NPC as the winner.
    - And my loss is recorded in the global and per-NPC statistics.
    - Given a hand concludes and the NPC's credit stack is now 0,
    - Then a match summary screen appears declaring me as the winner.
    - And my win is recorded in the global and per-NPC statistics.

- ID: US-015
- Title: Return to the start screen after a match
- Description: As a player, after a match is over, I want to be able to return to the start screen to play again or view stats.
- Acceptance Criteria:
    - Given the match summary screen is displayed,
    - When I click the "Return to Menu" button,
    - Then I am taken back to the start screen.

### Conversation
- ID: US-016
- Title: Send a message to the NPC
- Description: As a player, I want to send a text message to the NPC during a match to interact with them.
- Acceptance Criteria:
    - Given I am in the Game View and it's my turn,
    - When I type a message into the chat input field and press Enter or click "Send",
    - Then my message appears in the chat display area.
    - And a loading indicator appears while waiting for the NPC's response.

- ID: US-017
- Title: Receive a response from the NPC
- Description: As a player, after I send a message, I want to receive a contextually appropriate response from the NPC.
- Acceptance Criteria:
    - Given I have sent a message to the NPC,
    - Then after a short delay, the loading indicator disappears.
    - And a new message from the NPC appears in the chat display area.
    - And the response is in-character with the NPC's personality.

- ID: US-018
- Title: View conversation history
- Description: As a player, I want to be able to review my past conversations with an NPC to remember their personality and tells.
- Acceptance Criteria:
    - Given I am in the Game View,
    - When I click the "History" tab in the chat window,
    - Then the view switches to show a text block containing the full chat logs from the last 10 matches against this NPC.
    - And when I click back to the "Chat" tab, I see the conversation for the current match.

- ID: US-019
- Title: Handle abusive player messages
- Description: As an NPC, I should not be forced to respond to abusive or inappropriate messages from the player.
- Acceptance Criteria:
    - Given the player sends a message that is flagged as abusive,
    - Then the NPC responds with a generic, in-character dismissal (e.g., "I'd rather not talk about that," or "Let's just play cards.").
    - And the system does not pass the abusive query to the LLM for a full response.

### Statistics
- ID: US-020
- Title: Navigate to the statistics screen
- Description: As a player, I want to navigate from the start screen to a dedicated statistics screen to see my performance.
- Acceptance Criteria:
    - Given I am on the start screen,
    - When I click the "Statistics" button,
    - Then the application transitions to the Statistics View.

- ID: US-021
- Title: View global and per-NPC statistics
- Description: As a player, on the statistics screen, I want to see my overall win/loss record and also my record against each specific NPC.
- Acceptance Criteria:
    - Given I am on the Statistics View,
    - Then the screen displays my total wins, total losses, and overall win percentage.
    - And for each generated NPC, the screen displays my wins, losses, and win percentage against that character.

- ID: US-022
- Title: Return to start screen from statistics
- Description: As a player, I want a clear way to get back to the main menu from the statistics screen.
- Acceptance Criteria:
    - Given I am on the Statistics View,
    - When I click the "Back" or "Return to Menu" button,
    - Then the application transitions back to the start screen.

### Persistence and System
- ID: US-023
- Title: Game state loads on startup
- Description: As a user, I expect the application to remember my generated NPCs and statistics from my last session.
- Acceptance Criteria:
    - Given I have previously played the game and generated NPCs,
    - When I launch the application,
    - Then the start screen is populated with the same NPCs and the statistics screen shows my previously saved records.

- ID: US-024
- Title: Developer can debug NPC behavior
- Description: As a developer, I need a way to manually set an NPC's personality traits to test how they affect game strategy.
- Acceptance Criteria:
    - Given the game is not running,
    - When I open the `saves` folder and edit the JSON file for an NPC,
    - And I change the values for `aggression`, `bluffing`, or `risk_aversion`,
    - Then when I launch the game, the NPC's behavior in-game reflects these new, hardcoded values.

## 6. Success Metrics
### 6.1. Primary Goal (Educational)
- Metric: The primary success of the project is the developer's ability to successfully build and integrate an application using LLM technology.
- Measurement: This is a personal development goal, measured by the completion of the project to the specifications outlined in this document.

### 6.2. Core Functionality
- Metric: The application must be functionally complete and stable. All features defined in the functional requirements must operate without critical, game-breaking bugs.
- Measurement: This will be validated through a comprehensive manual testing pass by the developer, ensuring all user stories are met.

### 6.3. NPC Believability (Qualitative)
- Metric: The NPCs should feel more engaging, less predictable, and more "human" than typical poker AI. Their actions and conversation should reflect their underlying personality.
- Measurement: This is a qualitative metric that will be evaluated subjectively by the developer during gameplay and testing. The developer will use the debug mode (US-024) to create NPCs with extreme personality traits (e.g., 1.0 aggression, 0.0 risk_aversion) to validate that their behavior changes accordingly in a noticeable and believable way.
