<conversation_summary>
<decisions>
1.  **Poker Variant**: The MVP will implement No-Limit Texas Hold'em.
2.  **NPC Personality**: Opponent personalities will be driven by three 0.0-1.0 factors (`aggression`, `bluffing`, `risk_aversion`) derived from an LLM-generated backstory. These factors will influence game strategy.
3.  **NPC Generation**: A single button click generates a new NPC. The player will not see the underlying personality factors, forcing them to learn through gameplay and conversation.
4.  **Chat**: The player can have a text conversation with the NPC. The chat history will be available in a separate tab within the chat window, showing the full conversation from the last 10 matches as a single block of text. Abusive player queries will be met with a generic, in-character response.
5.  **Game Flow**: Each match is self-contained, starting with 1000 credits for both player and NPC. Blinds are fixed at 10/20. The match ends when one player runs out of credits.
6.  **Betting UI**: The player will use "Fold", "Check/Call", and "Raise" buttons. Raising will be handled via a UI slider.
7.  **Persistence**: Game state (NPCs, stats, chat history) will be saved in unencrypted JSON files within a `saves` folder located next to the game executable, ensuring portability. Mid-match progress will not be saved.
8.  **Statistics**: The game will track and display global and per-NPC win/loss records and win percentages.
9.  **Technical Priorities**: A technical spike will be prioritized to validate the Godot-to-local-LLM communication loop before full development.
10. **Asset and UI**: The UI will be functional, using standard Godot components. Visuals will come from pre-generated or Creative Commons images and open-source playing card assets.
</decisions>

<matched_recommendations>
1.  **Focus on a Popular Variant**: The decision to use Texas Hold'em aligns with the recommendation to choose a widely understood poker variant, simplifying core logic.
2.  **Map Personality to Actions**: The plan to use `aggression`, `bluffing`, and `risk_aversion` factors to drive NPC betting strategy directly implements the recommendation to connect personality to gameplay.
3.  **Isolate LLM for Conversation**: The NPC's game actions will be determined by rule-based logic using its personality factors, while the LLM will be used separately to generate chat. This follows the recommendation to prevent the LLM from making poor strategic decisions.
4.  **Prioritize Risk Mitigation**: Agreeing to the technical spike for LLM integration first addresses the highest-risk part of the project early, as recommended.
5.  **Manage User Experience**: Implementing loading indicators for LLM responses, handling API failures gracefully, and using a state machine for game flow are all adopted recommendations for a smoother user experience.
6.  **Scope Management for MVP**: Keeping matches self-contained, using fixed blinds, not saving mid-match state, and using pre-made assets are all accepted recommendations that keep the MVP scope manageable.
7.  **UI Design for Clarity**: The UI will persistently display player/NPC stacks and the pot size. The showdown will clearly announce the winner, and a slider will be used for intuitive bet sizing, all as recommended.
8.  **Establish Character**: The NPC will deliver an LLM-generated opening line at the start of a match to immediately establish its character, as recommended.
9.  **Enable Debugging**: The decision to allow hardcoding NPCs via the JSON file serves as the developer debug mode recommended for testing and tuning AI behavior.
10. **Standardize Game Rules**: The implementation of blinds, betting rounds, all-in scenarios, and ties (pushes) will follow standard poker conventions as recommended.
</matched_recommendations>

<prd_planning_summary>
This document summarizes the Product Requirements for the SpacePoker MVP.

**a. Main Functional Requirements:**
*   **Core Poker Engine**: A complete, functional No-Limit Texas Hold'em game engine, including logic for dealing, betting rounds, hand evaluation, and determining a winner.
*   **LLM-Powered NPCs**: The ability to generate up to 8 unique NPC opponents. Each NPC will have an LLM-generated backstory, which is then used to derive three personality factors (`aggression`, `bluffing`, `risk_aversion`) that dictate their gameplay style.
*   **Conversational AI**: Real-time, in-game text chat between the player and the NPC. The NPC's responses will be generated by a local LLM, guided by its established personality and backstory.
*   **Data Persistence**: All generated NPCs, player statistics (wins/losses), and a history of the last 10 full conversations per NPC will be saved to local JSON files.
*   **UI Views**: The application will feature a start screen for NPC management, a game view for playing poker, and a statistics screen to review performance.

**b. Key User Stories and Usage Paths:**
*   **Generating an Opponent**: A user launches the game, sees an empty slot, and clicks "Generate." After a brief loading state, a new NPC appears, ready to be challenged.
*   **Playing a Match**: The user selects a generated NPC, which takes them to the game table. They play a full match of No-Limit Texas Hold'em, starting with 1000 credits, until one player's credit reaches zero.
*   **Interacting with the NPC**: During the match, the user can type questions into a chat box. The NPC will respond with in-character messages generated by the LLM, revealing its personality over time. The user can switch to a "History" tab to review conversations from the last 10 matches against that NPC.
*   **Tracking Progress**: After several matches, the user navigates to the statistics screen to see their overall win/loss record and their specific performance against each individual NPC.
*   **Managing Opponents**: When all 8 NPC slots are full, the user can click a "delete" button on an existing NPC, confirm the action in a dialog, and free up the slot to generate a new opponent.

**c. Important Success Criteria and Ways to Measure Them:**
*   **Primary Goal (Educational)**: The project's main success is the user's ability to learn and implement an application integrating LLM technology. This is a personal development goal.
*   **Core Functionality**: All defined features (poker logic, NPC generation, chat, persistence) operate without critical bugs. This will be validated through manual testing.
*   **NPC Believability (Qualitative)**: The NPCs should feel less predictable and more engaging than standard poker AI. This will be evaluated subjectively by the developer during manual testing and debugging, using the ability to hardcode NPC personality values in the JSON save file to test specific scenarios.

</prd_planning_summary>

<unresolved_issues>
*   **AI Strategy Implementation**: The precise mathematical formula and logic for combining the three personality factors (`aggression`, `bluffing`, `risk_aversion`) with hand strength evaluation to produce a final, believable game action (e.g., how much to bet when bluffing) is not yet defined and will be determined during development and manual testing.
*   **Code Architecture**: A high-level code architecture (e.g., specific state machine design, class structure, scene organization in Godot) has not been planned and will be decided during the development phase.
</unresolved_issues>
</conversation_summary>
